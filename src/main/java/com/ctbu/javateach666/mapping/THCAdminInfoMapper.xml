<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ctbu.javateach666.dao.THCAdminInfoDao">
  <select id="initAdminInfo" resultType="com.ctbu.javateach666.pojo.po.THCAdminInfoPO">
    SELECT ad.* 
    FROM account a, adminsinfo ad 
    WHERE a.`userdetailid` = ad.`id` AND a.`username` = #{username}
  </select>
  
  <select id="getAdminInfoByAdminno" resultType="com.ctbu.javateach666.pojo.po.THCAdminInfoPO">
    SELECT * 
    FROM adminsinfo
    WHERE adminno = #{adminno}
  </select>
  <update id="updateAdminInfo" parameterType="com.ctbu.javateach666.pojo.po.THCAdminInfoPO">
	update adminsinfo
  	set adminphone = #{adminphone}, adminemail = #{adminemail}
  	where adminno = #{adminno}
  </update>
  
  <select id="getAdminPass" resultType="com.ctbu.javateach666.pojo.po.THCAccountPO">
    SELECT * 
    FROM account
    WHERE username = #{username}
  </select>
  
  <update id="updateAdminPass" parameterType="com.ctbu.javateach666.pojo.po.THCAccountPO">
	update account
  	set password = #{password}
  	where username = #{username}
  </update>
  
  
  <select id="getIndexImgbyPage" resultType="com.ctbu.javateach666.pojo.bo.THCIndexImgListRspBO" parameterType="com.ctbu.javateach666.pojo.bo.THCIndexImgListRepBO">
  	select imgno, imgname, imgurl, create_time, is_pub
  	from rollpicture
  	where is_delete = 0
  	<if test="imgname != null and imgname != '' ">
  		and imgname like concat('%',#{imgname},'%')
  	</if>
  	limit #{page}, #{rows}
  </select>
  
  <select id="getTotal" resultType="int" parameterType="com.ctbu.javateach666.pojo.bo.THCIndexImgListRepBO">
  	select count(*)
  	from rollpicture
  	where is_delete = 0
  	<if test="imgname != null and imgname != '' ">
  		and imgname like concat('%',#{imgname},'%')
  	</if>
  </select>
  
  <select id="getIndexImgbySearch" parameterType="com.ctbu.javateach666.pojo.bo.THCIndexImgListRepBO" resultType="com.ctbu.javateach666.pojo.bo.THCIndexImgListRspBO">
  	select imgno, imgname, imgurl, create_time, is_pub
  	from rollpicture
  	where is_delete = 0
  	<if test="imgname != null and imgname != '' ">
  		and imgname like concat('%',#{imgname},'%')
  	</if>
  </select>
  
  <update id="deleteIndexImg" parameterType="String">
  	update rollpicture set is_delete = 1
  	where imgno = #{imgno}
  </update>
  
  <insert id="addIndexImg" parameterType="com.ctbu.javateach666.pojo.po.THCIndexImgPO">
    insert into rollpicture(imgno, imgname, imgurl, create_time, is_pub)
    values(#{imgno}, #{imgname}, #{imgurl}, now(), #{is_pub})
  </insert>
  
  
  <select id="getJourbyPage" resultType="com.ctbu.javateach666.pojo.bo.THCJournalismListRspBO" parameterType="com.ctbu.javateach666.pojo.bo.THCJournalismListRepBO">
  	select j.joutitle, j.joucontent, j.joutype, j.starttime, j.endtime, a.adminname
  	from journalism j, adminsinfo a
  	where j.pubid = a.id
  	and j.is_delete = 0
  	and j.j_type = #{j_type}
  	<if test="joutitle != null and joutitle != '' ">
  		and j.joutitle like concat('%',#{joutitle},'%')
  	</if>
  	<if test="joucontent != null and joucontent != '' ">
  		and j.joucontent like concat('%',#{joucontent},'%')
  	</if>
  	limit #{page}, #{rows}
  </select>
  
  <select id="getJourTotal" resultType="int" parameterType="com.ctbu.javateach666.pojo.bo.THCJournalismListRepBO">
  	select count(*)
  	from journalism
  	where is_delete = 0
  	and j_type = #{j_type}
  	<if test="joutitle != null and joutitle != '' ">
  		and joutitle like concat('%',#{joutitle},'%')
  	</if>
  	<if test="joucontent != null and joucontent != '' ">
  		and joucontent like concat('%',#{joucontent},'%')
  	</if>
  </select>
  
  <select id="getJourbySearch" resultType="com.ctbu.javateach666.pojo.bo.THCJournalismListRspBO" parameterType="com.ctbu.javateach666.pojo.bo.THCJournalismListRepBO">
  	select j.joutitle, j.joucontent, j.joutype, j.starttime, j.endtime, a.adminname
  	from journalism j, adminsinfo a
  	where j.pubid = a.id
  	and j.is_delete = 0
  	and j.j_type = #{j_type}
  	<if test="joutitle != null and joutitle != '' ">
  		and j.joutitle like concat('%',#{joutitle},'%')
  	</if>
  	<if test="joucontent != null and joucontent != '' ">
  		and j.joucontent like concat('%',#{joucontent},'%')
  	</if>
  </select>
  
  
  <select id="getDicListbyPage" resultType="com.ctbu.javateach666.pojo.bo.THCDictionariesListRspBO" parameterType = "com.ctbu.javateach666.pojo.bo.THCDictionariesListRepBO">
  	select dicname, dtype, dvalue, remark, is_delete
  	from dictionaries
  	where is_delete = 0
  	<if test="dtype != null and dtype != '' ">
  		and dtype = #{dtype}
  	</if>
  	limit #{page}, #{rows}
  </select>
  
  <select id="getDicTotal" resultType="int" parameterType="com.ctbu.javateach666.pojo.bo.THCDictionariesListRepBO">
  	select count(*)
  	from dictionaries
  	where is_delete = 0
  	<if test="dtype != null and dtype != '' ">
  		and dtype = #{dtype}
  	</if>
  </select>
  
  <select id="getDicbySearch" parameterType="com.ctbu.javateach666.pojo.bo.THCDictionariesListRepBO" resultType="com.ctbu.javateach666.pojo.bo.THCDictionariesListRspBO">
  	select dicname, dtype, dvalue, remark, is_delete
  	from dictionaries
  	where is_delete = 0
  	<if test="dtype != null and dtype != '' ">
  		and dtype = #{dtype}
  	</if>
  </select>
  
  <update id="deleteDic" parameterType="String">
  	update dictionaries set is_delete = 1
  	where dicname = #{dicname}
  </update>
  
  <select id="getDicNameList" resultType="com.ctbu.javateach666.pojo.bo.THCDictionariesListRspBO">
  	select dtype
  	from dictionaries
  	where is_delete = 0
  	group by (dtype)
  </select>
</mapper>